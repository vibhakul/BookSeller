function findByField(){$("#addReview").hide(),$(".linkupdatebook").hide(),$(".linkaddreview").hide(),$("#addBook").hide(),$("#findby").show()}function pupulateReviews(a){var b="";a.preventDefault();var c=$(this).attr("rel"),d=bookList.map(function(a){return a._id}).indexOf(c),e=bookList[d],f="<strong>Title : "+e.title;f+="&nbsp; &nbsp;[ISBN :"+e.isbn+"]",f+="&nbsp;&nbsp;&nbsp;&nbsp; Author :"+e.author+"</strong>",$("#reviewList #bookInfo").html(f);var g=e.reviews;g.length>0?$.each(g,function(){b+="<tr><td><hr></td><td><hr></td><td><hr></td></tr>",b+="<tr><th>Name </th><th> &nbsp; : &nbsp;</th>",b+="<td>"+this.name+"</td></tr>",b+="<tr><th>Reviews </th><th>&nbsp; : &nbsp;</th>",b+="<td>"+this.review+"</td></tr>",b+="<tr><th>Rating </th><th>&nbsp; : &nbsp;</th>",b+="<td><div id="+this._id+" tooltip="+this.rate+">"+this.rate+"</div></td></tr>"}):b="<tr><td> No reviews for this book.. </td></tr>",$("#reviewList table tbody").html(b),addReviewRatingStar(g)}function populateTable(a,b){var c="?field="+a+"&value="+b;$.getJSON("/books/booklist"+c,function(a){bookList=a;var b=filledTable(a);$("#bookList table tbody").html(b),$("#addReview").hide(),$(".linkupdatebook").hide(),$(".linkaddreview").hide(),$("#addBook").hide(),$("#findby").hide(),addAvgRatingStar()})}function populateBookData(a){a.preventDefault(),$(".linkupdatebook").hide(),$(".linkaddreview").hide(),$("#addBook").show();var b=$(this).attr("rel"),c=bookList.map(function(a){return a._id}).indexOf(b),d=bookList[c];$("#inputbooktitle").val(d.title),$("#inputbookisbn").val(d.isbn),$("#inputbookauthor").val(d.author),$("#inputbookprice").val(d.price/100),$("#inputbookrate").val(d.average_rate/100),$("#hiddenbookid").val(d._id)}function addBookReviewData(a){a.preventDefault();var b=0;if($("#addReview input[type=text]").each(function(a,c){""===$(this).val()&&b++}),0!==b)return alert("Please fill in all fields"),!1;var c={review_name:$("#addReview input#inputbookreviewername").val(),review_dsc:$("#addReview input#inputbookreview").val(),review_rating:$("#reviewrate").rateYo("option","rating"),_id:$("#addReview input#hiddenreviewbookid").val()};$.ajax({type:"POST",data:c,url:"/books/addreview",dataType:"JSON"}).done(function(a){"success"==a.status?($("#addReview input").val(""),$("#addReview").hide(),$(".linkupdatebook").hide(),$(".linkaddreview").hide(),$("#addBook").hide(),$("#findby").hide(),populateTable("","")):alert("Error: "+a.msg)})}function addBookData(a){a.preventDefault();var b=0;$("#addBook input[type=text]").each(function(a,c){""===$(this).val()&&b++});var c=bookList.map(function(a){return a.isbn}).indexOf($("#addBook input#inputbookisbn").val());if(0!==b||c!==-1)return c===-1?alert("Please fill in all fields"):$("#addBook input#inputbookisbn").css({border:"#FF0000 1px solid"}),!1;var d={book_title:$("#addBook input#inputbooktitle").val(),book_isbn:$("#addBook input#inputbookisbn").val(),book_price:$("#addBook input#inputbookprice").val(),book_rating:$("#addBook input#inputbookrate").val(),book_author:$("#addBook input#inputbookauthor").val()};$.ajax({type:"POST",data:d,url:"/books/addbook",dataType:"JSON"}).done(function(a){"success"==a.status?($("#addBook input").val(""),$("#addReview").hide(),$(".linkupdatebook").hide(),$(".linkaddreview").hide(),$("#addBook").hide(),$("#findby").hide(),populateTable("","")):alert("Error: "+a.msg)})}function updateBookData(a){a.preventDefault();var b=0;if($("#addBook input").each(function(a,c){""===$(this).val()&&b++}),0!==b)return alert("Please fill in all fields"),!1;var c={book_title:$("#addBook input#inputbooktitle").val(),book_isbn:$("#addBook input#inputbookisbn").val(),book_price:$("#addBook input#inputbookprice").val(),book_rating:$("#addBook input#inputbookrate").val(),book_author:$("#addBook input#inputbookauthor").val()};$.ajax({type:"PUT",data:c,url:"/books/updatebook/"+$("#addBook input#hiddenbookid").val(),dataType:"JSON"}).done(function(a){"success"==a.status?($("#addBook input").val(""),$("#addReview").hide(),$(".linkupdatebook").hide(),$(".linkaddreview").hide(),$("#addBook").hide(),$("#findby").show(),populateTable("","")):alert("Error: "+a.msg)})}function deleteBookData(a){a.preventDefault();var b=confirm("Are you sure you want to delete this user?");return b===!0&&void $.ajax({type:"DELETE",url:"/books/deletebook/"+$(this).attr("rel")}).done(function(a){"success"==a.status||alert("Error: "+a.msg),populateTable("","")})}function populateBookReview(){event.preventDefault(),$(".linkupdatebook").hide(),$(".linkaddreview").hide(),$("#addBook").hide(),$("#addReview").show();var a=$(this).attr("rel"),b=bookList.map(function(a){return a._id}).indexOf(a),c=bookList[b];$("#labelreviewbooktitle").text(c.title),$("#labelreviewbookisbn").text(c.isbn),$("#hiddenreviewbookid").val(c._id)}function updatereviewbook(){$(".linkupdatebook").show(),$(".linkaddreview").show(),$("#btnUpdate").show(),$("#addReview").hide(),$("#findby").hide(),$("#addBook").hide(),$("#btnAdd").hide();var a=$(this).attr("rel");$("#addBookLink a").each(function(){this.rel=a}),$(".highlight").removeClass("highlight"),$(this).addClass("highlight")}function filledTable(a){var b="";return $.each(a,function(){b+='<tr class="" rel="'+this._id+'">',b+="<td>"+this.isbn+"</td>",b+="<td >"+this.title+"</td>",b+="<td>"+this.author+"</td>",b+="<td>"+this.price/100+"</td>",b+='<td><div id="'+this._id+'">'+this.average_rate/100+"</div></td>",b+='<td> <a href="#" class="linkreviewsbook" rel="'+this._id+'">Reviews ['+this.reviews.length+"]</a></td>",b+='<td><a href="#" class="linkdeletebook" rel="'+this._id+'">Delete</a></td>',b+="</tr>"}),b}function sortbypricebookData(){if("asc"==$(this).attr("rel")){var a="asc";$(this).attr("rel","desc"),$(".headerSortDown").removeClass("headerSortDown"),$(".headerSortUp").removeClass("headerSortUp"),$(this).addClass("headerSortUp")}else{$(this).attr("rel","asc");var a="desc";$(".headerSortDown").removeClass("headerSortDown"),$(".headerSortUp").removeClass("headerSortUp"),$(this).addClass("headerSortDown")}bookList.sort(function(b,c){return"asc"==a?b.price>c.price:b.price<c.price});var b=filledTable(bookList);$("#bookList table tbody").html(b),addAvgRatingStar()}function sortbyratebookData(){if("asc"==$(this).attr("rel")){var a="asc";$(this).attr("rel","desc"),$(".headerSortDown").removeClass("headerSortDown"),$(".headerSortUp").removeClass("headerSortUp"),$(this).addClass("headerSortUp")}else{$(this).attr("rel","asc");var a="desc";$(".headerSortDown").removeClass("headerSortDown"),$(".headerSortUp").removeClass("headerSortUp"),$(this).addClass("headerSortDown")}bookList.sort(function(b,c){return"asc"==a?b.average_rate>c.average_rate:b.average_rate<c.average_rate});var b=filledTable(bookList);$("#bookList table tbody").html(b),addAvgRatingStar()}function clearSearch(){$("#findby #inputsearch").val(""),$("#reviewList table tbody").empty(),$("#bookInfo").empty(),populateTable("","")}function showAddBook(){$("#addBook").show(),$("#btnAdd").show(),$("#addReview").hide(),$(".linkupdatebook").hide(),$(".linkaddreview").hide(),$("#findby").hide(),$("#btnUpdate").hide(),$("#addBook input").val("")}function findByData(){var a=$("#findby #selectedfield").val(),b=$("#findby #inputsearch").val();populateTable(a,b)}function addAvgRatingStar(){$.each(bookList,function(){$("#"+this._id).rateYo({rating:this.average_rate/100,readOnly:!0})})}function addReviewRatingStar(a){$.each(a,function(){$("#"+this._id).rateYo({rating:this.rate,readOnly:!0})})}var bookList=[];$(document).ready(function(){$("#addReview").hide(),$(".linkupdatebook").hide(),$(".linkaddreview").hide(),$("#addBook").hide(),$("#findby").hide(),populateTable("","")}),$("#bookList table tbody").on("click","tr",updatereviewbook),$("#addBookLink").on("click","a.linkupdatebook",populateBookData),$("#addBookLink").on("click","a.linkaddreview",populateBookReview),$("#addBookLink").on("click","a.linkshowaddbook",showAddBook),$("#btnAdd").on("click",addBookData),$("#btnAddReview").on("click",addBookReviewData),$("#btnUpdate").on("click",updateBookData),$("#bookList table tbody").on("click","td a.linkdeletebook",deleteBookData),$("#bookList table tbody").on("click","td a.linkreviewsbook",pupulateReviews),$("#btnSearch").on("click",findByData),$("#addBookLink").on("click","a.linkclearsearch",clearSearch),$("#addBookLink").on("click","a.linkfindby",findByField),$("#bookList table th[name=bookprice]").on("click",sortbypricebookData),$("#bookList table th[name=bookrate]").on("click",sortbyratebookData),$("#inputbookprice").on("keyup",function(){var a=/^\d{0,12}(\.\d{0,2})?$/.test(this.value),b=this.value;a||(this.value=b.substring(0,b.length-1))}),$(function(){$("#reviewrate").rateYo({normalFill:"#A0A0A0",fullStar:!0,rating:1})});